language: java

jdk:
  - openjdk17

# Need a full git clone in order to be able to tag the release
git:
  clone: false

install:
  - git clone https://github.com/$TRAVIS_REPO_SLUG.git $TRAVIS_REPO_SLUG
  - cd $TRAVIS_REPO_SLUG
  - git checkout $TRAVIS_BRANCH
  - POM_VERSION=$(mvn -q -Dexec.executable=echo -Dexec.args='${project.version}' --non-recursive exec:exec | sed -e 's/-SNAPSHOT//')
  - openssl aes-256-cbc -K $encrypted_044baa266d1a_key -iv $encrypted_044baa266d1a_iv -in .travis/gpg.asc.enc -out .travis/gpg.asc -d
  - gpg --fast-import .travis/gpg.asc

env:
  global:
    # Environment variables referenced in .travis/maven-settings.xml. To encrypt and escape values correctly, run the following
    # command and enter ENV_VAR=value when prompted:
    # read -r && travis encrypt "$(printf %q "$REPLY")"
    - secure: pxopjRstUZ12EnZHSQQNrrb9ftXROT2mIZokjnaxb8rQiQTlKZFqGY6UM4oXvGaZWoe+PrLVssomWPfSPIWLXP43kXljt3JYz1LvNd+vznZpSHEaE2fkhFG+83MaADPUtTrHO2HiYD3eZOk46x3jcXNqoKrKmk8mIZCQtDQQdqvAoTkN5JxWoFYpwr4cPnduhl45lYB3goDyp2YRom9bksGgWrzBfH3N59WA+d3Rw6SQ8IU16xuZujB/yA1xR1tji94qR4IH1z9M5Njp9k48Khci7PO+3eJgAEdxoV+00laMxoVFuW/WxoqINrh9YLyfM/0fjMn/pnVSc/XFDJ0bjaG3d6TWqZu3ZoucMbPn6qMLkeNezPiBiTesC7Ra1Xtwtg8xOqVmJgjxGNQDC+ljat+oYVvawXW9cyBDkBh4Cs2QAbBAwHjAAdQISrLOIcbUNJ7UbeSNEfZOJBKJq+LP1DeHG3AvdbK17rwy5SWUPwet+c73LsifEM3ZOy0oaIJXLcddKQiB3Z7D9JDN47UHtyn6pRumDdtnL7NxrcsNbgp9Gz1JlrTsSklb41T2WxJgL2fdLLx5ykn2he+tIF87v5QjrvuFZN1VjN11Csrl5s7b//vrRpqlWNnUvEUOTfbVbsuA6UbhqUuWiQTosoJt4JHv/mm44eJOSAvg+DTI/LM=
    - secure: lZNu7pOeIZ0NJfsCmLdsaq/bJ9g/TROvOr/MKR59AT21Y+ukk4RCK84E+yXOfvbAkCRQTdOJnER648YCuRG/uqZHgpMb030nDbF3kyg+vKxV+gObW4/LublWHy+CP0eEsw0zYuDUPpoJng61FhPPZo2qx2ylvRE+RkdA1+9Hk+gPHL4BKLPG6qyyef5r2rctxcqxuDkiqtowYCqkecwaGNEHe1LXps6aGcMziAnaucrdJBQz/M+ZFboVbPw9MIpDa9iHUNeFo9l6N5Size+AY8J+yFLVR4DfvoDuCvrq1zqS8JnuMJQu2kDcCQIjKXC8GMvMfz6vl4BVT9YEAaQjZB77hXFo/W5oPLprFW5r72yRGtT6q4ZpG90rGUblTCqDj9dSAwG2bW09mfcWlMH0198vu9mGoTDoATDOqB4KdBJgKHOkQFED0Awmai3UKLBFlP+HKCwfwC7sH+8W4bov7Li++JiiYFEwW5kLgJex+XBbRH6uR4ZY3vSvOex4cMdOGucBoKBU3NgRHqof/V/wxkZrsEvrcf4sZYo+gQyUrIpNBQgph2FtLJQUP08vFhlvGBFAdziRVmBt7Xptk9YXLWmt6ymS4Ye+s9La9I6ieAqKuLnJdKQUOz3VWlTS9w1+Yf0Bcu051EP8eCVJsfFQttFcZ3Mt0sFzNYVQnFr7qzI=
    - secure: iYY2HzJrK0bLRFjItOl8Ft77T4IQCHOjaFTMQXL6XdKEKH6zP9rWkXYKtfALrCTv+1D8+/9RbziFaYyCVoz/3piQh5sotdxg+174o2j5PMsiQXtO4kQ9q4kEc5/9SeZ0cVhjGzcix5h1F/xzusoZjyb0WETeuomGOEBIxzFi8av9altGAx+gblcYGkXY7bFzoCi8tKiyPnKmME7nvB8w7PPvq87xrFxvnb6eEuB+KFiGTwr76SGS3SCuBzGpqAREglFf6NP+RPe26f7OpzIpGO5RHuqyukN1hcle6JqPYvbMyPsafFGnxyrFgGHU9n943mG5VBSDqnf4xVXHCBtasrHKM3yJWfHwz6/hSB6Hom4Os6NfSc9PZd/+ucPZ5VOQMQVWjPm+Cb+ggm6P1qcXMfQL4HB6SlJsThbV2T+52YK1xS7Xz2Ur+pqwssRKGRS3wMFku7o7ftR+ggdiDqZka6gZ2rMSxTXBk/DzfF8jddpPVBsQh3NxDBKgNRBS9ZnLCajXG9EgyypEE+QJQkucZO12E6ATcbLLbqiIYBs40MR+kcYWrO0nbdwMHL6s0IZZg7eIvTJkTAxxTh/yuhCsANkf1Vy43hWy9z2iLKLcAyRuJOT4B/ZueXM81lXSnger6eDcTjxvdsX3QxK2QOc51WlNIyYp/UjLXnlOsVa8NpA=
    - secure: YgOxwJI8LqQFceaaElzW++45n/dxKQYZKCX9svLZKHC5WNqcQz/ykCZxhdXTn6XI0U6s/mEfIvdwEE6D8s8/YDmIRssJ+/iaxpvoVIHf6mHqUCeZunYX1t0XOUno4RhdbkxgGszx44Ksn3Dc/KKISoAjSxSTBZr/e1+Lut0yaimzO7FnSrDTOFgFYmANtAvf9KdqZzmnyGsVn6/Ebcl3elC+Zdp6xkiIcFaHVrSKLiZ7lOe+2ozAlkJ0NQ9SHsYBxAXIYF3zGYf99ysw6lwNZh2g4AEE2l87cZytBs9od6QHbcN9MNsCzP1xpezrLn+WT0OcMxTK7QcVASAQ0Y78roQ9uR749v6pM3CeaCx2EJ3qCVoDnrR+4cDSmVFGzNtBKNegpjohEaPt8Cm2PeC+aXvLGV6x/U3S9i+RwBzO3ANq/Ds7lzMPu33Z2HZEUeJmagVVMjTTFKMvbgdw7kyxqFzm/NhwXlWNwq52VDhPoQO1LLt3vo8btaEVamhZYAt4OG8xB4pw33W8wqGquI1HeQICWnuKmheW/A7+wTce7YgMUE9mJKdNzelAbSzUygaDxbz90jNF5pOj4CiuhLeAX4I0OgL1B0FfOrZvFcJrL1+B98Bi/m1NJiTMUwjt6yWh0HLMjEDgOlccpZRUpZkoxkpBzA4RrR4yVl/050hPwxo=
    - secure: xDb/mbazhpx0IBzz2M0rjJ5ZOLJfekxDl7Oi7lqFTP18SlBjFzCM3pwafLW+lxE+ByD6nCs5nbboHvOUtYPWci37d+qUBFVGNgRL6rSryE/0us20mRDLCOuaqzCDFemGg2H1oUOCb+843G/a7ZnmcJOPkIlRSwocSbswVFu11HXK/BjOcBeezyhekW4ylo0Py3nz6wiOQSpKOlna9f9rDuoOCVy/VOEq17DJuDlZQdZLCnieOFZYmF1Xb4rdXy5Ibj+lKvYsLd+m1OGxQaJ7pPLa1A4fV1s4xROxAI/Ss99JBJBuV2RSOOYfOByozRkPucmHGiHEvJ6jSE7VvOjmqB9v7L1mwYwfMNiBLP0G9KN9IS8qf9AUvZq3mSCB07j+BvscUjkTesfdn49CXW2S5W++uBf4j22kaVIi/eg8ulY88rR8uxd+hFCiiImlTbdEkPAaTau+VTtGXyFb1e5br++Kd/uHGWR/YBmc2hAlq0SvEw1Vn+gJZMML6XV9l0SLnJfX6POxDSz5URMmrnZe29p2I8DtiJ/1NBlv/gwcgQasQnwfqQ33EJSpN+GzhRFxe7gi4eIfNmXQLpCB9pjfCrX2z7kxMg4f1q84CTFoDWk/riv2oT/Wo9j2JY284RC5P8aBqv0CXMgpK3BDugarUfZh9EOF6DuDYMybZKBZ8r4=

script:
  - mvn clean install -B
  - mvn org.pitest:pitest-maven:mutationCoverage -B

before_deploy:
  # Set tag to be used by releases provider
  - export TRAVIS_TAG=$POM_VERSION

deploy:
  # For any checkin to main branch, create a final version, tag it and push the artifacts to Sonatype
  - provider: script
    skip_cleanup: true
    script:
      mvn --settings .travis/maven-settings.xml release:prepare release:perform -DskipTests -Prelease -B
    on:
      branch: main

  # Releases config copied from https://docs.travis-ci.com/user/deployment/releases/ and secure key generated by following
  # https://stackoverflow.com/questions/25302518/travis-ci-setup-releases-with-github-token#answer-57032190
  - provider: releases
    api_key:
      secure: u5QftqKjIzksSh+GGf253FfgGPCY8/KhPbpvtyiSuhT/UMY+hef3lSmSUq8715AOqQemeO5O8JpN1j+GWbVaz3Nv6nZ4rCSlG69LAxpYMiDj8E1BaHxKTnfuBJnC9HeLHZBPQaupJYyJeUDOn0W6ffh8K4WAVhhcTzdMOSGZsRhAS+RKKQMfhq+aiXZcnkTh6gyfCOheLODIuGtcpvl5aorgTAnoov8j6kGxjtIdkUIEalMlyRs0MNprGqlsFn70uzVp6O+BzQj7zPGdqdHxk4wDHrHnaYGGtYSyX1hPqcNuWv8hdch16DjqdeFLs7d0zNCIs0BCqlWOGq0I1k1UTo29SqsyezTzW9pHZfyRRmZxQBVth+DO7S6TDOieCbiEacxfbN4WIqmRuY98TDcT1HZI0B1GIXjqm/+ac//ToyXkIP7hoUYWjRqDJenaZwCALh3rPu4Me1yQBJVMdNJU2xWBdlodEcA1f4CTZZsp5XBBWazo8hegQPr9DYW5r03SsjYhhyKFnDN3q9NmwXTT5aK85eLPBFm27Xswbso8Fdla3psh1kqmLx9bu0tMAkXw4mK/CG57dl0r8mG91z67U51T4Qfm1PQ6CYKbDgZMJAhybNxRvL5t81jqKUL2mMcfD/LSmKgnAiqB+NFv8vLIkYgJ5CQOsylkVlCPnZuAGBo=
    file:
      - "spt-development-cid-web-spring-boot-autoconfigure/target/spt-development-cid-web-spring-boot-autoconfigure-${POM_VERSION}.jar"
      - "spt-development-cid-web-spring-boot-starter/target/spt-development-cid-web-spring-boot-starter-${POM_VERSION}.jar"
    skip_cleanup: true
    on:
      branch: main
